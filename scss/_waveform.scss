// ============================================
// Waveform Visualization
// ============================================

.waveform {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  pointer-events: none;
  z-index: 5;
  // Container stays at full opacity - individual paths handle their own opacity

  // Hide when Spotify bar is expanded (only in final state)
  &:not(.waveform--loading):not(.waveform--drawing):not(.waveform--dropping) {
    .spotify-bar.expanded ~ & {
      opacity: 0;
    }
  }
}

.waveform-svg {
  width: 100%;
  height: 100%;
  overflow: visible;
}

.waveform-path {
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  opacity: 0; // Start invisible, loading animation will fade in
  transition: opacity var(--duration-wave-animation) cubic-bezier(0.25, 0.46, 0.45, 0.94), stroke 0.5s ease;
}

// Layer 1 - Back (slowest, largest amplitude)
// Note: opacity controlled by loading states in _loading.scss
.waveform-path-1 {
  stroke: var(--color-accent);
  stroke-width: 3;
  animation: waveformAnimate1 8s ease-in-out infinite;
}

// Layer 2 - Middle
.waveform-path-2 {
  stroke: var(--color-work-primary);
  stroke-width: 2;
  animation: waveformAnimate2 6s ease-in-out infinite;
}

// Layer 3 - Front (fastest, smallest amplitude)
.waveform-path-3 {
  stroke: var(--color-experience-primary);
  stroke-width: 1.5;
  animation: waveformAnimate3 4s ease-in-out infinite;
}

// Final opacity state (after loading animation completes)
.waveform:not(.waveform--loading) {
  .waveform-path-1 { opacity: 0.3; }
  .waveform-path-2 { opacity: 0.5; }
  .waveform-path-3 { opacity: 0.7; }
}

// Mode-based waveform colors
[data-mode="work"] {
  .waveform-path-1 {
    stroke: var(--color-work-secondary);
  }
  .waveform-path-2 {
    stroke: var(--color-work-primary);
  }
  .waveform-path-3 {
    stroke: var(--color-work-accent);
  }
}

[data-mode="experience"] {
  .waveform-path-1 {
    stroke: var(--color-experience-secondary);
  }
  .waveform-path-2 {
    stroke: var(--color-experience-primary);
  }
  .waveform-path-3 {
    stroke: var(--color-experience-accent);
  }
}

// Waveform animations
// These will be overridden by JS for dynamic waves
// But provide fallback animation

@keyframes waveformAnimate1 {
  0%, 100% {
    d: path("M0,100 Q360,50 720,100 T1440,100");
  }
  50% {
    d: path("M0,100 Q360,150 720,100 T1440,100");
  }
}

@keyframes waveformAnimate2 {
  0%, 100% {
    d: path("M0,120 Q360,80 720,120 T1440,120");
  }
  50% {
    d: path("M0,120 Q360,160 720,120 T1440,120");
  }
}

@keyframes waveformAnimate3 {
  0%, 100% {
    d: path("M0,140 Q360,120 720,140 T1440,140");
  }
  50% {
    d: path("M0,140 Q360,160 720,140 T1440,140");
  }
}

// Heartbeat mode (when not playing music)
.waveform.heartbeat {
  .waveform-path {
    animation-timing-function: ease-in-out;
  }

  .waveform-path-2 {
    animation: heartbeatWave 1.5s ease-in-out infinite;
  }
}

@keyframes heartbeatWave {
  0%, 100% {
    d: path("M0,150 L400,150 Q450,150 500,150 Q550,100 600,150 Q650,200 700,150 Q750,150 800,150 L1440,150");
  }
  25% {
    d: path("M0,150 L400,150 Q450,150 500,150 Q550,80 600,150 Q650,220 700,150 Q750,150 800,150 L1440,150");
  }
  50% {
    d: path("M0,150 L400,150 Q450,150 500,150 Q550,120 600,150 Q650,180 700,150 Q750,150 800,150 L1440,150");
  }
}

// Reduced motion
@media (prefers-reduced-motion: reduce) {
  .waveform-path {
    animation: none !important;
  }
}

// Mobile Optimizations - Simplified waveform
@media (max-width: 639px) {
  .waveform {
    height: 100px;
    opacity: 0.4;
  }

  // Hide extra layers on mobile for performance
  .waveform-path-1,
  .waveform-path-3 {
    display: none;
  }

  .waveform-path-2 {
    stroke-width: 1.5;
    opacity: 0.6;
  }
}

// Very small screens - even simpler
@media (max-width: 400px) {
  .waveform {
    height: 40px;
    opacity: 0.2;
  }
}
