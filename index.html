<!--
    --------------------------------------------------------------------------------------
    Welcome to the source of ENKR1.github.io!

    I am Pang Jing Hui, also known as ENKR, a Full-Stack Software Engineer and Beatbox Artist.
    My work spans across innovative web development and rhythmic beatbox performances.

    This website is a canvas where my technical skills and creative passions converge.
    Developed and designed entirely by myself, it showcases my journey and projects in both
    the tech world and the beatboxing community.

    Feel free to explore the code and connect with me:
    - LinkedIn: https://www.linkedin.com/in/jinghuipang/
    - GitHub: @enkr1
    - Instagram: @enkr1
    - YouTube: @enkr1

    Thank you for visiting and happy coding!
    --------------------------------------------------------------------------------------
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <title>ENKR | PANG Jing Hui | 彭竞辉 - Software Engineer & Beatbox Artist</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="referrer" content="origin" />
    <meta name="author" content="ENKR | PANG Jing Hui | 彭竞辉" />
    <meta name="keywords"
        content="Pang Jing Hui, Jing Hui, ENKR, software developer, full-stack engineer, Singapore IT professional, beatboxer, beatbox artist, beatboxing, rhythm, vocal percussion, vonderie, vonderie beatbox, 555, 555 beatbox, tech and music, coding, programming, web development, UI/UX, JavaScript, Elixir, PHP, beatbox battles, live performances, beatbox community">
    <meta property="og:description"
        content="Explore the innovative works of PANG Jing Hui, a tech enthusiast and beatbox performer based in Singapore." />
    <meta property="og:image" content="/images/3.jpg" />
    <meta property="og:url" content="https://enkr1.github.io/v2" />
    <meta http-equiv="content-language" content="en">

    <link rel="icon" href="/v2/images/logo.gif" type="image/gif" sizes="16x16" />
    <link rel="stylesheet" href="css/main.css?v=2.0.2" />
</head>

<body class="is-loading">
    <div id="platform-page"></div>
    <div id="star-section"></div>

    <div id="spotify-container"
        style="margin: 3rem 0 0; text-align: center; border: 1px solid #fff;backdrop-filter: blur(3px);padding: 1rem;">
        <h1>Spotify API Test</h1>
        <h1>Spotify Currently Playing</h1>
        <div id="track-info">Loading...</div>
    </div>
    <script type="text/javascript" defer src="js/main.js"></script>

    <div class="footer">
        <p>&copy; 2022 ENKR. All rights reserved.</p>
        <p>Developed and designed by ENKR</p>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            let params = new URLSearchParams(window.location.search);
            let code = params.get('code');
            console.log("Authorization code:", code);
            if (code) {
                // We have a code, let's exchange it for an access token and then get the currently playing track
                fetchAccessToken(code, function (accessToken) {
                    fetchCurrentlyPlaying(accessToken);
                });
            } else {
                // No code found in URL, handle accordingly
                document.getElementById('track-info').innerText = 'No Spotify code found. Please authorize first.';
            }
        });

        function fetchAccessToken(code, callback) {
            // This is a placeholder for server-side logic.
            // You should replace this with a call to your server or serverless function.

            // The server would handle the POST request to the Spotify Accounts service.
            // Example server-side endpoint might be '/get-spotify-token' on your server.
            fetch('/get-spotify-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ code: code })
            })
                .then(response => response.json())
                .then(data => {
                    // Assuming your server responds with the access token in the 'data' object
                    console.log('Access token:', data.accessToken);
                    callback(data.accessToken);
                })
                .catch(error => {
                    console.error('Error during token exchange:', error);
                });
        }

        function fetchCurrentlyPlaying(accessToken) {
            console.log("Access token received:", accessToken);
            fetch('https://api.spotify.com/v1/me/player/currently-playing', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            }).then(response => {
                console.log("API response received", response);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            }).then(data => {
                console.log('Currently playing data:', data);
                displayTrackInfo(data);
            }).catch(error => {
                console.error('Error fetching currently playing:', error);
            });
        }

        function displayTrackInfo(data) {
            console.log("Displaying track info:", data);
            let trackInfoDiv = document.getElementById('track-info');
            if (data && data.item) {
                let trackName = data.item.name;
                let artists = data.item.artists.map(artist => artist.name).join(', ');
                trackInfoDiv.innerHTML = `Now Playing: ${trackName} by ${artists}`;
            } else {
                trackInfoDiv.innerText = 'Nothing is currently playing.';
            }
        }



    </script>
</body>

</html>
